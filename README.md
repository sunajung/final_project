# **Term Project - Shopping mall** - by suna jung
---
<br>

## **프로젝트 설명**

> 웹 응용 프로그래밍 수업의 Term project 입니다.<br>
> HTML, CSS, JS, Node.js, DB연동, 인증 기능 사용, 배운 내용 외 적용 7가지를 모두 충족했습니다.<br> 
> 상품 구매, 커뮤니티 기능이 포함된 쇼핑몰을 제작했으며, 홈페이지 주소는 http://www.suna-shop.com/ 입니다. <br> 7가지 항목을 순서대로 설명하겠습니다. <br>

<br>

## **주요 기능 설명** 
---
<br>

크게 **`HTML/ CSS, 디자인, JS, Node.js, DB연동, 인증 기능 사용, 배운 내용 외 적용`** 으로 구성됩니다. <br>

### **[ HTML, CSS ]**

<br>

- 쇼핑몰을 구현하기 위해 필요한 HTML 페이지와 각각에 대응되는 CSS를 구현했습니다.
- 구현한 페이지는 크게 **메인화면, 로그인, 회원가입, 장바구니, 마이페이지, 비밀번호 확인, 회원정보 수정, 주소찾기(팝업), 게시판, 게시글 상세, 글쓰기, 제품 상세설명, 제품 게시판, 모델 소개**입니다.

### **[ 웹페이지 디자인 ]**

<br>

- 애견용품 판매점, 각종 커뮤니티, 쿠팡사이트를 참고해서 쇼핑몰에 필요한 기능을 선정했고, 여성 의류 쇼핑몰 사이트를 참고하여 디자인의 방향성을 잡았습니다.
- 감성적인 느낌을 주기 위해 연한 회색, 베이지, 분홍색 컬러를 중점으로 디자인했고, 각각의 요소들의 비율을 맞춰 제작했습니다.

### **[ javascript를 사용하여 웹페이지를 구현 ]**

<br>

JS가 적용된 주요 부분을 소개하겠습니다.

#### __1. 공통- 헤더의 큰 범주 클릭 시 하위메뉴 드롭다운__
<br>

- 드롭다운을 위해, 하위메뉴 div의 class에 “hidden”값을 추가했습니다. 
- 큰 범주(커뮤니티, 상품 판매, 모델 소식 버튼) 각각에 click event listener를 등록하여, class에 hidden이 있다면 그대로, hidden이 없다면 하위메뉴가 밑으로 내려가 사용자에게 보이도록 구현했습니다. <br>


#### __2) 장바구니, 즉시 구매 클릭 시 로그인 여부 판별 및 해당 기능 수행__
<br>

- 장바구니, 즉시 구매 버튼에 click event listener를 각각 등록했습니다. 
- 먼저 로그인 여부를 판별하고, 비로그인 상태일 시 실패 메시지와 함께 함수는 종료됩니다. 
- 로그인 상태라면 fetch함수를 이용하여 post형식의 요청을 보내고, 서버에서 요청을 수행하게 되면 result값을 받아와 성공 시 성공 메시지를, 실패 시 실패 메시지를 띄웁니다.<br>

#### __3) 메인 : 광고(배너) 자동 변경 및 클릭시 페이지 이동__
<br>

- 배너의 하단 버튼에 click event listener를 등록하여 각 버튼 클릭 시 버튼에 해당하는 배경의 class를 배너에 교체해줍니다.
- 지난 시간을 저장하는 counter변수를 timer로 이용해서, 3초마다 배너가 바뀌도록 구현했습니다.
- page url을 계산하고, location.href를 이용하여 배너 클릭시 현재 보이는 배너의 게시글로 이동합니다. <br>

#### __4) 메인 : 회원가입, 회원정보 변경__
<br>

- 각 항목 적절성 여부 체크
	- 회원가입 form에 submit event listener를 등록하여 각 항목의 값을 읽게 했습니다. 필수입력 항목이 비었거나, 각 항목들에 조건에 맞지 않는 값이 들어왔을 경우 이벤트를 중단합니다.

	- `① ID`
		- 영어와 숫자로 구성이 가능하며 최소 8자, 최대 20자를 제한으로 두고, 조건과 다를 경우 에러처리를 했습니다. 
		- 중복체크 여부를 확인하는 isPossibleID변수를 두어 해당 ID가 이미 등록되어있는지 확인하는 로직을 추가했습니다. (fetch함수를 이용해 비동기로 처리)
	- `② Password`
		- 비밀번호는 길이를 측정하여 8자리 미만의 경우 에러처리를 했습니다. 
		- 영문, 숫자, 특수문자의 조합으로 이루어지며 적어도 2가지를 사용하게 했습니다. 이때 포함 여부 확인을 위해 정규식을 사용했습니다.

			``` javascript
			var numPattern = /[0-9]/; //숫자
			var alphabetPattern = /[a-zA-Z]/; //알파벳
			var spePattern = /[~!@\\\#$%<>^&*\(\)]/; //특수문자
			numPattern( str ) // str에 해당 패턴이 포함되어있는지 여부를 반환.
			```

		- input event listener를 등록하여 비밀번호의 상태에 따라 안내문이 다르게 출력되도록 구현했습니다.

	- `③ 주소, 핸드폰 번호 (선택항목)`
		- 주소, 핸드폰 번호의 경우 두 칸으로 이루어져 있습니다. 한 칸만 값이 들어있을 경우 비정상적인 입력이므로 해당 경우에는 에러처리 했습니다. 
		- 주소입력은 이전 과제였던 [api사용] 코드를 그대로 가져왔습니다.
	
<br>

#### __5) 마이페이지 - 구매내역 삭제__
<br>

 - 구매내역 삭제 버튼에 click event listener를 등록, 해당 item의 pid를 서버로 보내 db에서 삭제하게 했습니다. 
- 이때 confirm 함수를 이용하여 삭제 여부를 묻는 팝업을 뜨게 했습니다.

<br>

#### __6) 게시글 상세- 댓글에 아무 내용도 없을 경우 실패처리__
<br>

-  trim()함수를 사용해, 공백과 개행으로만 이루어진 댓글은 실패처리 및 경고문을 띄웁니다.

<br>

#### __7) 제품 게시판에서 화면 가로 크기에 따른 asdie 위치 조절__
<br>

 - aside는 fixed된 상태이므로 가로 크기에 상관없이 항상 같은 자리를 유지합니다.
 - left = %로 조절하기엔 문제가 있었습니다. 따라서, 원하는 위치는 section의 바로 옆이므로 (화면 가로 – section가로) / 2 + section가로 = (화면 가로 + section 가로) / 2를 도출해내어 left의 값에 적용했습니다.

<br>

#### __8)장바구니- 제품 각각 구매, 전체 구매 구현__
<br>

 - 제품 각각의 버튼에 click event listener를 등록하여 각각의 제품의 id를 매개변수로 주었습니다. 구매 시에는 버튼의 값을 배열에 저장해, 서버에 전송하여 구매처리를 합니다.

<br>

#### __9)글쓰기__
- 제목이나 내용 누락 시 실패처리
	- 글쓰기 버튼을 눌렀을 때 제목이나 내용의 input값을 확인하여 둘중에 하나라도 비었을 경우 경고메시지와 함께 에러처리하며, 서버로 전송하지 않습니다.
- 수정 및 삭제 기능도 구현했습니다.

<br><br>

### **[ Node.js(express)서버를 구동하여 웹페이지 구현 ]**

<br>

nodejs, npm express를 차례로 설치하여 서버를 구동했습니다. nodemon을 install하여 파일 변경시마다 자동으로 서버를 reboot할 수 있게 했습니다.

<br>

#### __1) multer 패키지 : 이미지 업로드를 위한 패키지__
- 수업 시간에 배우지 않은 패키지로, 파일을 입력받아 처리할 수 있는 패키지입니다. 
- 글쓰기를 구현할때 이미지 등록을 위해 사용했습니다.
<br>

#### __2) nunjuck tag사용__
html에 적절한 태그를 통해 서버에서 내려준 값을 파싱합니다.

- `① for tag 사용`
	- 게시글, 상품 게시판, 구매내역 등 개수가 많고 반복해서 html을 작성해야 하는 경우 사용한 태그입니다.

- `② if tag 사용`
	- 수업 자료에서는 isAuthenticated를 통해 인증여부에 따라 다른 html을 표현하기 위해 쓰였습니다.
	- 이를 응용해서, 글 상세 화면에서 글쓴이와 현재 세션의 유저를 비교해 같을 경우에만 수정, 삭제버튼이 나타나게 추가로 적용했습니다. 또한, 각각의 유저에게 레벨을 두어 레벨 2이상(운영자)의 경우 글쓴이와 상관 없이 버튼이 나타나게 했습니다.

- `③ include tag 사용`
	- extend와 다르게 해당하는 html의 내용을 전부 가져옵니다. aside가 메인화면, 제품 게시판에만 등장하므로 이를 쉽게 구현하기 위해 사용했습니다.

- `④ set tag 사용`
	- if tag와 연계하여 조건에 따라 다르게 적용해야 하는 값을 저장할 때 사용했습니다. 

	- 다음은 현재 페이지와 표시하려는 페이지가 같으면 seleted-page가 되고, 미리 작성해둔 css에 의해 다르게 표시되는 코드입니다.

		``` javascript
		{% if page == pageNumber %}
    		{% set selected = ' selected-page' %}
		{% else %}
    		{% set selected = '' %}
		{% endif %}
		<button class="page-button{{selected}}" 
		```
<br>

#### __3) 서버와 상호작용 필요한 로직들__
 
  url에 따라 작성하겠습니다. (ex) /detail/:pid => https://아이피:포트/detail/2, pid는 2에 해당

- `① 제품 상세 ( /detail )`
	- `⑴ GET /:pid` : pid에 해당하는 제품의 정보를 db에서 가져와 뿌려줍니다. 이때 최근 본 목록을 구현하기 위해 cookie[‘looking’]에 해당하는 pid값이 있는지 확인 후, 없을 경우 담아주었습니다. 

	- `⑵ POST /` : 장바구니 담기 기능이 구현되어 있습니다. req.body에서 pid 값을 읽어와cookie[‘shopping’]에 추가합니다.

- `② 구매 ( /buy )`
	- `⑴ POST /` : body에서 items를 읽어와 각각의 item에 대해 구매처리를 진행합니다. 구매와 동시에 장바구니( cookie[‘shopping’] ) 에서 제거됩니다.

- `③게시판( /board )`
	- `⑴ GET /`:board/:pageNumber : 해당하는 조건의 데이터를 DB에서 검색한 후, 원하는 개수만큼 잘라 응답으로 전송했습니다. (sort, skip, limit을 사용)
<br><br>

### **[ DB를 연동하여 웹 페이지 구현 ]**

<br>
	사용한 collection은 총 9가지로 아래와 같습니다.
<br>

- `① users (사용자 정보)`
	: Id, password(가상), hashedPassword, address, detailAddress, fullAddress(가상, 주소 합쳐서 저장), phone1, phone2, phone3, phone(가상, 전화번호 합쳐서 저장)
- `② usercounters (현재 유저 수를 저장)` : count
- `③ boards (게시판 종류)` : pid, boardName
- `④ posts (게시글 정보)` 
	: pid, title, content, writer, view, idPerBoard(게시글 마다 독립적인 번호체계를 활용하기 위함), like, createdAt, updatedAt.
- `⑤ postcounters (각 게시판 글 수 카운팅 및 넘버링 위함)` : board, count
- `⑥ likes (좋아요 누른 사람과 누른 게시물)` : liker, post
- `⑦ comments (댓글 정보)` : content, writer, post
- `⑧ buys (구매 정보)` : buyer, product
- `⑨ product (제품 정보)` 
	: pid, name, title, titlePrefix(부제 개념), price, detail(상세설명 페이지에 들어가는 내용)

<br><br>

### **[ 인증 기능 사용 여부 ]**

<br>

- 로그인 구현 - 12주차 강의자료의 예제를 활용하여 login을 구현했습니다. 예제와 동일하게 password는 virtual 속성을 주었고, 진짜 비밀번호는 hashedPassword에 암호화되어 저장됩니다.

<br><br>

### **[ 기타 강의시간에 배운 내용 외의 내용을 적용한 경우 ]**

<br>

#### 1) 도전과제 달성!
 
- 도전 과제인 등록한 게시글이 나열되는 영역, 게시글을 등록하는 폼을 제작했습니다. 여기에 추가로, 게시글 나열 영역은 페이지네이션을, 게시글 등록 폼은 이미지와 영상 추가도 가능하도록 제작했습니다. 

<br>

#### 2) mongoDB compass 이용하여 csv형태의 자료를 집어넣었습니다.

<br> 

#### 3) 글쓰기 에디터 opensource 이용
 
- summernote를 활용하여 글쓰기 기능을 일반적인 커뮤니티의 글쓰기처럼 만들었습니다.

- 이미지 업로드는 콜백을 등록하여 서버에 이미지를 전송하는 이벤트 발생 시, 응답으로 전송된 url의 서버 주소를 받아와 게시글에 적절한 img 태그 및 src속성을 부여하여 표현했습니다. 

<br> 

#### 4) javascript를 이용하여 css에 직접 접근
 
- aside위치 조정에 사용했던 방법으로. getElementsByClassName등의 emement 검색 함수를 이용하여 변수에 담고, element.style 내부의 값에 원하는 값을 대입하여 사용했습니다.

<br> 

#### 5) 게시물 및 상품 검색 기능 추가
 
- 사이트의 헤더에서 검색 시 상품 검색이 가능하고, 해당 게시판 밑의 검색창에서 검색하면 게시판에 있는 글 중에서 검색이 가능합니다.

#### 6) 강의시간에 배운내용에서 모두 심화된내용을 적용.
 
- 단순히 표면적으로 배운 내용외에, 해당 내용을 구글링하고 직접 적용해보는 시행착오를 거쳐 실제 사이트와 유사한 퀄리티로 사이트를 제작했습니다.

<br><br>


## **비고 및 고찰** 
---
<br>
이왕 사이트를 만드는 거, 제대로 만들어보자는 생각이 들어서 구매와 커뮤니티 기능을 모두 포함한 쇼핑몰에 도전했습니다.<br> 디테일에 신경쓰다보니 1주간 거의 밤을새며 제작했을정도로 작업이 길어졌습니다. 이번 프로젝트를 진행하며 셀 수도 없이 많은 오류를 보게 되었는데, 그만큼 실력이 많이 는 것 같아 뿌듯합니다.
<br><br>
제작을 하면서 만난 숱한 문제중 주요적인 것은 다음과 같습니다.
<br><br>

### **제작 시 주요사항** <br>

**1. 배너 클릭 시 해당하는 이벤트 페이지로 이동** <br>
=> 현재 제가 제작한 사이트는 banner에 해당하는 div를 하나만 쓰고 background image를 돌려쓰는 방식을 사용중입니다. click event listener 또한 하나만 사용할 수 있었으며, 이동해야하는 이벤트 페이지는 배너 개수만큼 되므로 html내의 onclick으로는 커버할 수 없었습니다. 이를 어떻게 할지 많은 고민 끝에, click event listener에서 nowBanner 값을 보고 이동해야 하는 page url을 그때 계산하게 하고, location.href를 이용하여 현재 보여지는 배너의 게시글로 이동하게 제작했습니다.

**2. multer 패키지( 이미지 업로드를 위한 패키지)** <br>
=> 이미지를 등록하면 <img>태그가 자동으로 적용되어 이미지를 첨부할 수 있었는데, 문제는 local 환경에서 올린 이미지다 보니 서버에 해당 태그가 그대로 올라가면 이미지를 찾지 못해 표시를 하지 못하는 문제가 발생했습니다. 
<br><br> 이를 방지하기 위해 이미지 게시 시에 서버에 해당 이미지 파일을 전송한 후, 서버기준으로 해당 이미지 파일의 url을 다시 응답으로 전송하여 해당 url을 src의 value값으로 사용했습니다. 서버에 있는 이미지이므로 다른 유저가 보더라도 이미지가 정상적으로 보이게 되어, 원활한 처리가 가능했습니다.

**3. javescript 부모요소 클릭 이벤트 차단** <br>
=> 배너 아래 버튼 클릭 시 배너 사진이 변경되는 것을 구현할 때, 자식 element에 클릭 이벤트가 일어날 경우, 부모가 겹쳐있다면 부모 또한 클릭 이벤트를 받게 되는 현상을 발견했습니다. 이때 사진이 바뀌기도 전에 이벤트페이지로 넘어가는 문제가 생겼습니다.<br><br>
 e.stopPropagation(); 함수를 이용하면 더 이상 이벤트가 전파되지 않고 해당 엘리먼트에서 멈춰서, 클릭 이벤트 진행 시 해당 함수를 호출하는 것으로 해결했습니다.

 구현하고 싶은 기능과 표면적인 기술사이에 괴리가 있어서, JS로 CSS를 조정하거나 선택자를 지정하는 방법 등 다양한 부분에서 심화된 내용이 필요했습니다. 강의 PPT와 구글링을 통해서 배운 것 외, 혹은 심화내용을 직접 익히고 적용함으로써 문제들을 해결할 수 있었습니다. 또, AWS에서 제공하는 도메인 서비스를 결제해 원하는 도메인 주소로 쇼핑몰에 접근할 수 있도록 했습니다.
